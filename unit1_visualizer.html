<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unit 1 — Descriptive Statistics Visualizer</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Instrument+Serif:ital@0;1&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0c0c14;
  --bg2: #111119;
  --bg3: #181824;
  --border: #1e1e30;
  --border-h: #2e2e48;
  --text: #e4e2ee;
  --dim: #8a88a0;
  --muted: #555568;
  --cyan: #06b6d4;
  --amber: #f59e0b;
  --pink: #f472b6;
  --green: #34d399;
  --purple: #a78bfa;
  --orange: #fb923c;
  --cyan-g: rgba(6,182,212,0.12);
  --amber-g: rgba(245,158,11,0.12);
  --pink-g: rgba(244,114,182,0.12);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; line-height:1.6; }
body::before { content:''; position:fixed; inset:0; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events:none; z-index:9999; }

.header { text-align:center; padding:60px 20px 40px; }
.header .tag { font-family:'Space Mono',monospace; font-size:11px; letter-spacing:4px; text-transform:uppercase; color:var(--muted); margin-bottom:12px; }
.header h1 { font-family:'Instrument Serif',serif; font-size:clamp(36px,5vw,56px); font-weight:400; letter-spacing:-1px; margin-bottom:8px; }
.header h1 em { font-style:italic; color:var(--cyan); }
.header p { color:var(--dim); font-size:15px; max-width:550px; margin:0 auto; font-weight:300; }

.tabs { display:flex; justify-content:center; gap:4px; padding:0 20px 40px; flex-wrap:wrap; }
.tab-btn { font-family:'Space Mono',monospace; font-size:11px; letter-spacing:1px; text-transform:uppercase; padding:10px 20px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; transition:all 0.3s; }
.tab-btn:first-child { border-radius:6px 0 0 6px; }
.tab-btn:last-child { border-radius:0 6px 6px 0; }
.tab-btn.active { background:var(--bg3); color:var(--text); border-color:var(--border-h); }
.tab-btn:hover { color:var(--text); }

.panel { display:none; max-width:1100px; margin:0 auto; padding:0 24px 80px; animation:fadeUp 0.4s ease; }
.panel.active { display:block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

/* Histogram panel */
.viz-container { background:var(--bg2); border:1px solid var(--border); border-radius:12px; padding:32px; margin-bottom:24px; }
.viz-title { font-family:'Instrument Serif',serif; font-size:24px; margin-bottom:4px; }
.viz-desc { color:var(--dim); font-size:13px; margin-bottom:24px; font-weight:300; }

canvas { display:block; width:100%; border-radius:8px; }

.controls { display:flex; flex-wrap:wrap; gap:16px; margin-top:20px; align-items:center; }
.control-group { display:flex; flex-direction:column; gap:4px; }
.control-label { font-family:'Space Mono',monospace; font-size:10px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); }
.control-group input[type=range] { width:180px; accent-color:var(--cyan); }
.control-group select, .control-group button {
  font-family:'DM Sans',sans-serif; font-size:13px; padding:6px 14px;
  background:var(--bg3); border:1px solid var(--border); color:var(--text);
  border-radius:6px; cursor:pointer; transition:all 0.2s;
}
.control-group select:hover, .control-group button:hover { border-color:var(--border-h); }
.btn-accent { background:var(--cyan-g) !important; border-color:rgba(6,182,212,0.3) !important; color:var(--cyan) !important; }

/* Stats display */
.stats-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px; margin-top:20px; }
.stat-card { background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:14px 16px; text-align:center; }
.stat-value { font-family:'Space Mono',monospace; font-size:20px; font-weight:700; }
.stat-label { font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:1px; margin-top:2px; font-family:'Space Mono',monospace; }
.stat-mean .stat-value { color:var(--cyan); }
.stat-median .stat-value { color:var(--amber); }
.stat-mode .stat-value { color:var(--pink); }
.stat-sd .stat-value { color:var(--purple); }
.stat-iqr .stat-value { color:var(--green); }
.stat-range .stat-value { color:var(--orange); }

/* Explanation box */
.explain-box { background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:20px 24px; margin-top:20px; }
.explain-box h3 { font-family:'Instrument Serif',serif; font-size:18px; margin-bottom:8px; }
.explain-box p { font-size:13px; color:var(--dim); line-height:1.7; }
.explain-box .formula { font-family:'Space Mono',monospace; font-size:12px; background:var(--bg2); padding:8px 14px; border-radius:6px; margin:8px 0; color:var(--cyan); display:inline-block; }

/* Data input */
.data-input-row { display:flex; gap:12px; margin-top:16px; align-items:flex-end; }
.data-input-row input { flex:1; font-family:'Space Mono',monospace; font-size:13px; padding:8px 14px; background:var(--bg); border:1px solid var(--border); color:var(--text); border-radius:6px; }
.data-input-row input:focus { outline:none; border-color:var(--cyan); }
.data-input-row input::placeholder { color:var(--muted); }

/* Boxplot specifics */
.legend { display:flex; gap:20px; margin-top:16px; flex-wrap:wrap; }
.legend-item { display:flex; align-items:center; gap:6px; font-size:12px; color:var(--dim); }
.legend-dot { width:10px; height:10px; border-radius:2px; }

/* Normal dist */
.slider-val { font-family:'Space Mono',monospace; font-size:12px; color:var(--cyan); margin-left:8px; }

@media(max-width:600px) {
  .controls { flex-direction:column; }
  .control-group input[type=range] { width:100%; }
  .stats-row { grid-template-columns:repeat(3,1fr); }
}
</style>
</head>
<body>

<div class="header">
  <p class="tag">Unit 1 — Descriptive Statistics</p>
  <h1>Interactive <em>Visualizer</em></h1>
  <p>Play with data, build intuition. Every chart updates in real time as you change the data.</p>
</div>

<div class="tabs">
  <button class="tab-btn active" onclick="showTab('histogram',this)">Histogram</button>
  <button class="tab-btn" onclick="showTab('boxplot',this)">Boxplot</button>
  <button class="tab-btn" onclick="showTab('normal',this)">Normal Curve</button>
  <button class="tab-btn" onclick="showTab('compare',this)">Compare Distributions</button>
</div>

<!-- HISTOGRAM PANEL -->
<div class="panel active" id="histogram">
  <div class="viz-container">
    <div class="viz-title">Interactive Histogram</div>
    <div class="viz-desc">See how the shape, center, and spread change as you modify the data. Try different presets or enter your own data.</div>
    <canvas id="histCanvas" height="320"></canvas>
    <div class="stats-row">
      <div class="stat-card stat-mean"><div class="stat-value" id="hMean">—</div><div class="stat-label">Mean</div></div>
      <div class="stat-card stat-median"><div class="stat-value" id="hMedian">—</div><div class="stat-label">Median</div></div>
      <div class="stat-card stat-mode"><div class="stat-value" id="hMode">—</div><div class="stat-label">Mode</div></div>
      <div class="stat-card stat-sd"><div class="stat-value" id="hSD">—</div><div class="stat-label">Std Dev</div></div>
      <div class="stat-card stat-iqr"><div class="stat-value" id="hIQR">—</div><div class="stat-label">IQR</div></div>
      <div class="stat-card stat-range"><div class="stat-value" id="hRange">—</div><div class="stat-label">Range</div></div>
    </div>
    <div class="controls">
      <div class="control-group">
        <span class="control-label">Preset data</span>
        <select id="histPreset" onchange="loadPreset()">
          <option value="symmetric">Symmetric (bell-shaped)</option>
          <option value="right">Right skewed</option>
          <option value="left">Left skewed</option>
          <option value="bimodal">Bimodal</option>
          <option value="uniform">Uniform</option>
        </select>
      </div>
      <div class="control-group">
        <span class="control-label">Bins</span>
        <input type="range" id="binSlider" min="3" max="25" value="10" oninput="drawHistogram()">
      </div>
      <div class="control-group">
        <span class="control-label">Sample size</span>
        <input type="range" id="sizeSlider" min="20" max="500" value="100" oninput="loadPreset()">
      </div>
    </div>
    <div class="data-input-row">
      <input type="text" id="customData" placeholder="Or enter your own data: 2, 5, 7, 3, 9, 12, 5, 8...">
      <button class="btn-accent" onclick="loadCustom()" style="font-family:'DM Sans'; font-size:13px; padding:8px 18px; background:var(--cyan-g); border:1px solid rgba(6,182,212,0.3); color:var(--cyan); border-radius:6px; cursor:pointer;">Load</button>
    </div>
  </div>
  <div class="explain-box">
    <h3>What to notice</h3>
    <p>The <strong style="color:var(--cyan)">mean</strong> (blue line) is pulled toward the tail in skewed distributions. The <strong style="color:var(--amber)">median</strong> (gold line) resists outliers — it stays near the center of the data. When mean &gt; median, the data is right-skewed. When mean &lt; median, it's left-skewed. Try switching between presets and watch how the lines move relative to each other.</p>
    <div class="formula">Mean = Σxᵢ / n &nbsp;&nbsp;&nbsp; Median = middle value when sorted</div>
  </div>
</div>

<!-- BOXPLOT PANEL -->
<div class="panel" id="boxplot">
  <div class="viz-container">
    <div class="viz-title">Five-Number Summary & Boxplot</div>
    <div class="viz-desc">Visualize the five-number summary: min, Q1, median, Q3, max. Outliers shown as individual dots. Drag the slider to add outliers and see what happens.</div>
    <canvas id="boxCanvas" height="280"></canvas>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-value" id="bMin" style="color:var(--orange)">—</div><div class="stat-label">Min</div></div>
      <div class="stat-card"><div class="stat-value" id="bQ1" style="color:var(--green)">—</div><div class="stat-label">Q1</div></div>
      <div class="stat-card stat-median"><div class="stat-value" id="bMed">—</div><div class="stat-label">Median</div></div>
      <div class="stat-card"><div class="stat-value" id="bQ3" style="color:var(--green)">—</div><div class="stat-label">Q3</div></div>
      <div class="stat-card"><div class="stat-value" id="bMax" style="color:var(--orange)">—</div><div class="stat-label">Max</div></div>
      <div class="stat-card stat-iqr"><div class="stat-value" id="bIQR">—</div><div class="stat-label">IQR</div></div>
    </div>
    <div class="controls">
      <div class="control-group">
        <span class="control-label">Dataset</span>
        <select id="boxPreset" onchange="drawBoxplot()">
          <option value="symmetric">Symmetric</option>
          <option value="right">Right skewed</option>
          <option value="outliers">Has outliers</option>
        </select>
      </div>
      <div class="control-group">
        <span class="control-label">Add extreme value</span>
        <input type="range" id="outlierSlider" min="0" max="100" value="0" oninput="drawBoxplot()">
      </div>
    </div>
    <div class="legend">
      <div class="legend-item"><div class="legend-dot" style="background:var(--cyan)"></div>Box (Q1–Q3)</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--amber)"></div>Median line</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--dim)"></div>Whiskers</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--pink);border-radius:50%"></div>Outliers (beyond 1.5×IQR)</div>
    </div>
  </div>
  <div class="explain-box">
    <h3>How to read a boxplot</h3>
    <p>The box spans Q1 to Q3 — this is the <strong>interquartile range (IQR)</strong>, containing the middle 50% of data. The line inside is the median. Whiskers extend to the furthest data point within 1.5×IQR of the box edges. Anything beyond is an <strong style="color:var(--pink)">outlier</strong>. Try dragging the "add extreme value" slider and watch how the outlier appears while the box barely moves — that's the power of quartile-based measures.</p>
    <div class="formula">IQR = Q3 − Q1 &nbsp;&nbsp;&nbsp; Outlier if x &lt; Q1 − 1.5·IQR or x &gt; Q3 + 1.5·IQR</div>
  </div>
</div>

<!-- NORMAL CURVE PANEL -->
<div class="panel" id="normal">
  <div class="viz-container">
    <div class="viz-title">The Normal Distribution</div>
    <div class="viz-desc">Adjust μ (mean) and σ (standard deviation) to see how the bell curve changes. The shaded regions show the 68-95-99.7 rule.</div>
    <canvas id="normalCanvas" height="360"></canvas>
    <div class="controls">
      <div class="control-group">
        <span class="control-label">μ (mean) <span class="slider-val" id="muVal">0</span></span>
        <input type="range" id="muSlider" min="-4" max="4" value="0" step="0.1" oninput="drawNormal()">
      </div>
      <div class="control-group">
        <span class="control-label">σ (std dev) <span class="slider-val" id="sigVal">1</span></span>
        <input type="range" id="sigSlider" min="0.3" max="3" value="1" step="0.1" oninput="drawNormal()">
      </div>
      <div class="control-group">
        <span class="control-label">Show region</span>
        <select id="normalRegion" onchange="drawNormal()">
          <option value="none">None</option>
          <option value="68" selected>68% (μ ± 1σ)</option>
          <option value="95">95% (μ ± 2σ)</option>
          <option value="997">99.7% (μ ± 3σ)</option>
          <option value="custom">Custom z-score</option>
        </select>
      </div>
      <div class="control-group" id="zGroup" style="display:none">
        <span class="control-label">z-score <span class="slider-val" id="zVal">1.96</span></span>
        <input type="range" id="zSlider" min="0" max="4" value="1.96" step="0.01" oninput="drawNormal()">
      </div>
    </div>
    <div class="stats-row" style="margin-top:16px">
      <div class="stat-card stat-mean"><div class="stat-value" id="nArea">68.3%</div><div class="stat-label">Shaded area</div></div>
      <div class="stat-card stat-median"><div class="stat-value" id="nLeft">—</div><div class="stat-label">Left bound</div></div>
      <div class="stat-card stat-sd"><div class="stat-value" id="nRight">—</div><div class="stat-label">Right bound</div></div>
    </div>
  </div>
  <div class="explain-box">
    <h3>The 68-95-99.7 Rule</h3>
    <p>In any normal distribution, approximately <strong style="color:var(--cyan)">68%</strong> of data falls within 1 standard deviation of the mean, <strong style="color:var(--amber)">95%</strong> within 2, and <strong style="color:var(--pink)">99.7%</strong> within 3. This is why σ matters so much — it tells you how "spread out" the data is. A z-score tells you how many standard deviations a value is from the mean.</p>
    <div class="formula">z = (x − μ) / σ &nbsp;&nbsp;&nbsp; P(μ−kσ &lt; X &lt; μ+kσ)</div>
  </div>
</div>

<!-- COMPARE PANEL -->
<div class="panel" id="compare">
  <div class="viz-container">
    <div class="viz-title">Compare Two Distributions</div>
    <div class="viz-desc">Same mean can have different spread. Same spread can have different center. See how these properties are independent.</div>
    <canvas id="compareCanvas" height="340"></canvas>
    <div class="controls">
      <div class="control-group">
        <span class="control-label">Dist A: μ <span class="slider-val" id="muA">0</span></span>
        <input type="range" id="muASlider" min="-4" max="4" value="0" step="0.1" oninput="drawCompare()">
      </div>
      <div class="control-group">
        <span class="control-label">Dist A: σ <span class="slider-val" id="sigA">1</span></span>
        <input type="range" id="sigASlider" min="0.3" max="3" value="1" step="0.1" oninput="drawCompare()">
      </div>
      <div class="control-group">
        <span class="control-label">Dist B: μ <span class="slider-val" id="muB">2</span></span>
        <input type="range" id="muBSlider" min="-4" max="4" value="2" step="0.1" oninput="drawCompare()">
      </div>
      <div class="control-group">
        <span class="control-label">Dist B: σ <span class="slider-val" id="sigB">0.7</span></span>
        <input type="range" id="sigBSlider" min="0.3" max="3" value="0.7" step="0.1" oninput="drawCompare()">
      </div>
    </div>
    <div class="legend" style="margin-top:16px">
      <div class="legend-item"><div class="legend-dot" style="background:var(--cyan)"></div>Distribution A</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--pink)"></div>Distribution B</div>
    </div>
  </div>
  <div class="explain-box">
    <h3>Center vs. Spread</h3>
    <p>Two distributions can have the <strong>same mean but different standard deviations</strong> — one tall and narrow, the other short and wide. They can also have the <strong>same spread but different centers</strong>. Try setting both σ values equal and sliding the means apart. Then set both means equal and change the σ values. This is the difference between <em>location</em> and <em>scale</em> — two of the most fundamental ideas in statistics.</p>
  </div>
</div>

<script>
// --- Utilities ---
function rand(a,b){return a+Math.random()*(b-a)}
function randn(){let u=0,v=0;while(!u)u=Math.random();while(!v)v=Math.random();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)}
function sorted(a){return[...a].sort((x,y)=>x-y)}
function mean(a){return a.reduce((s,v)=>s+v,0)/a.length}
function median(a){const s=sorted(a),m=Math.floor(s.length/2);return s.length%2?s[m]:(s[m-1]+s[m])/2}
function mode(a){const f={};a.forEach(v=>{const k=Math.round(v*2)/2;f[k]=(f[k]||0)+1});let mx=0,mv=0;for(let k in f)if(f[k]>mx){mx=f[k];mv=+k}return mv}
function stdev(a){const m=mean(a);return Math.sqrt(a.reduce((s,v)=>s+(v-m)**2,0)/a.length)}
function quantile(a,q){const s=sorted(a),p=(s.length-1)*q,b=Math.floor(p),f=p-b;return s[b]+(s[b+1]-s[b]||0)*f}
function normalPDF(x,mu,sig){return Math.exp(-0.5*((x-mu)/sig)**2)/(sig*Math.sqrt(2*Math.PI))}
function erf(x){const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;const s=x<0?-1:1;x=Math.abs(x);const t=1/(1+p*x);const y=1-(((((a5*t+a4)*t)+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);return s*y}
function normalCDF(x,mu,sig){return 0.5*(1+erf((x-mu)/(sig*Math.sqrt(2))))}

let histData = [];

// --- Generate data ---
function genData(type, n) {
  const d = [];
  if(type==='symmetric') for(let i=0;i<n;i++) d.push(randn()*15+50);
  else if(type==='right') for(let i=0;i<n;i++) d.push(Math.exp(randn()*0.5+2));
  else if(type==='left') for(let i=0;i<n;i++) d.push(100-Math.exp(randn()*0.5+2));
  else if(type==='bimodal') for(let i=0;i<n;i++) d.push(Math.random()<0.5?randn()*8+30:randn()*8+70);
  else if(type==='uniform') for(let i=0;i<n;i++) d.push(rand(10,90));
  return d;
}

// --- Tab switching ---
function showTab(id,btn) {
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(btn)btn.classList.add('active');
  if(id==='histogram') drawHistogram();
  if(id==='boxplot') drawBoxplot();
  if(id==='normal') drawNormal();
  if(id==='compare') drawCompare();
}

// --- Histogram ---
function loadPreset() {
  const type = document.getElementById('histPreset').value;
  const n = +document.getElementById('sizeSlider').value;
  histData = genData(type, n);
  drawHistogram();
}

function loadCustom() {
  const raw = document.getElementById('customData').value;
  const nums = raw.split(/[,\s]+/).map(Number).filter(v=>!isNaN(v));
  if(nums.length>1) { histData = nums; drawHistogram(); }
}

function drawHistogram() {
  if(!histData.length) return;
  const canvas = document.getElementById('histCanvas');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  canvas.width = canvas.offsetWidth * dpr;
  canvas.height = 320 * dpr;
  ctx.scale(dpr, dpr);
  const W = canvas.offsetWidth, H = 320;
  ctx.clearRect(0,0,W,H);

  const bins = +document.getElementById('binSlider').value;
  const mn = Math.min(...histData), mx = Math.max(...histData);
  const bw = (mx-mn)/bins || 1;
  const counts = new Array(bins).fill(0);
  histData.forEach(v => { let b=Math.min(Math.floor((v-mn)/bw),bins-1); counts[b]++; });
  const maxC = Math.max(...counts);

  const pad = {l:50,r:20,t:20,b:40};
  const pw = W-pad.l-pad.r, ph = H-pad.t-pad.b;

  // Grid
  ctx.strokeStyle = '#1e1e30'; ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const y=pad.t+ph*(1-i/4);
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
    ctx.fillStyle='#55556888';ctx.font='11px Space Mono';ctx.textAlign='right';
    ctx.fillText(Math.round(maxC*i/4),pad.l-8,y+4);
  }

  // Bars
  const barW = pw/bins;
  counts.forEach((c,i) => {
    const x = pad.l + i*barW;
    const h = (c/maxC)*ph;
    const y = pad.t+ph-h;
    const grad = ctx.createLinearGradient(x,y,x,pad.t+ph);
    grad.addColorStop(0,'rgba(6,182,212,0.7)');
    grad.addColorStop(1,'rgba(6,182,212,0.15)');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.roundRect(x+1,y,barW-2,h,3);
    ctx.fill();
  });

  // X labels
  ctx.fillStyle='#55556888'; ctx.font='10px Space Mono'; ctx.textAlign='center';
  for(let i=0;i<=bins;i+=Math.max(1,Math.floor(bins/6))){
    ctx.fillText((mn+i*bw).toFixed(1), pad.l+i*barW, H-pad.b+18);
  }

  // Mean & Median lines
  const m = mean(histData), med = median(histData);
  const mX = pad.l + ((m-mn)/(mx-mn))*pw;
  const medX = pad.l + ((med-mn)/(mx-mn))*pw;

  ctx.setLineDash([6,4]);
  ctx.strokeStyle='#06b6d4'; ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(mX,pad.t);ctx.lineTo(mX,pad.t+ph);ctx.stroke();
  ctx.strokeStyle='#f59e0b';
  ctx.beginPath();ctx.moveTo(medX,pad.t);ctx.lineTo(medX,pad.t+ph);ctx.stroke();
  ctx.setLineDash([]);

  // Labels
  ctx.font='11px DM Sans';
  ctx.fillStyle='#06b6d4'; ctx.textAlign='left';
  ctx.fillText('Mean',mX+6,pad.t+14);
  ctx.fillStyle='#f59e0b';
  ctx.fillText('Median',medX+6,pad.t+30);

  // Update stats
  const sd = stdev(histData), q1=quantile(histData,0.25), q3=quantile(histData,0.75);
  document.getElementById('hMean').textContent = m.toFixed(2);
  document.getElementById('hMedian').textContent = med.toFixed(2);
  document.getElementById('hMode').textContent = mode(histData).toFixed(1);
  document.getElementById('hSD').textContent = sd.toFixed(2);
  document.getElementById('hIQR').textContent = (q3-q1).toFixed(2);
  document.getElementById('hRange').textContent = (mx-mn).toFixed(2);
}

// --- Boxplot ---
function drawBoxplot() {
  const type = document.getElementById('boxPreset').value;
  let data;
  if(type==='symmetric') data=[12,15,17,18,19,20,20,21,22,23,24,25,26,27,28,29,30,31,33,35];
  else if(type==='right') data=[2,3,4,5,5,6,7,8,9,10,12,15,20,25,35,50];
  else data=[5,10,12,14,15,16,17,18,19,20,21,22,23,24,25,60];

  const outlierVal = +document.getElementById('outlierSlider').value;
  if(outlierVal > 0) data = [...data, data[data.length-1] + outlierVal*1.5];

  const s = sorted(data);
  const mn=s[0], mx=s[s.length-1], q1=quantile(s,0.25), med=median(s), q3=quantile(s,0.75);
  const iqr=q3-q1, lo=q1-1.5*iqr, hi=q3+1.5*iqr;
  const wLo=s.find(v=>v>=lo), wHi=[...s].reverse().find(v=>v<=hi);
  const outliers = s.filter(v=>v<lo||v>hi);

  document.getElementById('bMin').textContent=mn.toFixed(1);
  document.getElementById('bQ1').textContent=q1.toFixed(1);
  document.getElementById('bMed').textContent=med.toFixed(1);
  document.getElementById('bQ3').textContent=q3.toFixed(1);
  document.getElementById('bMax').textContent=mx.toFixed(1);
  document.getElementById('bIQR').textContent=iqr.toFixed(1);

  const canvas=document.getElementById('boxCanvas'),ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  canvas.width=canvas.offsetWidth*dpr; canvas.height=280*dpr;
  ctx.scale(dpr,dpr);
  const W=canvas.offsetWidth,H=280;
  ctx.clearRect(0,0,W,H);

  const pad={l:60,r:60,t:60,b:60};
  const pw=W-pad.l-pad.r;
  const toX=v=>pad.l+((v-mn)/(mx-mn))*pw;
  const cy=H/2;

  // Axis
  ctx.strokeStyle='#1e1e30'; ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(pad.l,H-pad.b+20);ctx.lineTo(W-pad.r,H-pad.b+20);ctx.stroke();
  ctx.fillStyle='#55556888';ctx.font='10px Space Mono';ctx.textAlign='center';
  const step=(mx-mn)/5;
  for(let i=0;i<=5;i++){
    const v=mn+i*step;
    ctx.fillText(v.toFixed(1),toX(v),H-pad.b+36);
  }

  // Whiskers
  ctx.strokeStyle='#8a88a0';ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(toX(wLo),cy);ctx.lineTo(toX(q1),cy);ctx.stroke();
  ctx.beginPath();ctx.moveTo(toX(q3),cy);ctx.lineTo(toX(wHi),cy);ctx.stroke();
  // Whisker caps
  ctx.beginPath();ctx.moveTo(toX(wLo),cy-15);ctx.lineTo(toX(wLo),cy+15);ctx.stroke();
  ctx.beginPath();ctx.moveTo(toX(wHi),cy-15);ctx.lineTo(toX(wHi),cy+15);ctx.stroke();

  // Box
  const bx=toX(q1), bx2=toX(q3), bh=60;
  const grad=ctx.createLinearGradient(bx,cy-bh/2,bx2,cy+bh/2);
  grad.addColorStop(0,'rgba(6,182,212,0.25)');grad.addColorStop(1,'rgba(6,182,212,0.08)');
  ctx.fillStyle=grad;
  ctx.strokeStyle='#06b6d4';ctx.lineWidth=2;
  ctx.beginPath();ctx.roundRect(bx,cy-bh/2,bx2-bx,bh,4);ctx.fill();ctx.stroke();

  // Median
  ctx.strokeStyle='#f59e0b';ctx.lineWidth=3;
  ctx.beginPath();ctx.moveTo(toX(med),cy-bh/2);ctx.lineTo(toX(med),cy+bh/2);ctx.stroke();

  // Outliers
  outliers.forEach(v=>{
    ctx.beginPath();ctx.arc(toX(v),cy,6,0,Math.PI*2);
    ctx.fillStyle='rgba(244,114,182,0.5)';ctx.fill();
    ctx.strokeStyle='#f472b6';ctx.lineWidth=1.5;ctx.stroke();
  });

  // Data dots
  s.filter(v=>v>=lo&&v<=hi).forEach(v=>{
    ctx.beginPath();ctx.arc(toX(v),cy+bh/2+18,2.5,0,Math.PI*2);
    ctx.fillStyle='rgba(255,255,255,0.15)';ctx.fill();
  });
}

// --- Normal ---
function drawNormal() {
  const mu=+document.getElementById('muSlider').value;
  const sig=+document.getElementById('sigSlider').value;
  const region=document.getElementById('normalRegion').value;
  document.getElementById('muVal').textContent=mu.toFixed(1);
  document.getElementById('sigVal').textContent=sig.toFixed(1);
  document.getElementById('zGroup').style.display=region==='custom'?'flex':'none';

  let k=1;
  if(region==='68')k=1;else if(region==='95')k=2;else if(region==='997')k=3;
  else if(region==='custom'){k=+document.getElementById('zSlider').value;document.getElementById('zVal').textContent=k.toFixed(2);}

  const lo=mu-k*sig, hi=mu+k*sig;
  const area = region==='none'?0:(normalCDF(hi,mu,sig)-normalCDF(lo,mu,sig))*100;
  document.getElementById('nArea').textContent=region==='none'?'—':area.toFixed(1)+'%';
  document.getElementById('nLeft').textContent=region==='none'?'—':lo.toFixed(2);
  document.getElementById('nRight').textContent=region==='none'?'—':hi.toFixed(2);

  const canvas=document.getElementById('normalCanvas'),ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  canvas.width=canvas.offsetWidth*dpr;canvas.height=360*dpr;
  ctx.scale(dpr,dpr);
  const W=canvas.offsetWidth,H=360;
  ctx.clearRect(0,0,W,H);

  const pad={l:50,r:30,t:30,b:50};
  const pw=W-pad.l-pad.r,ph=H-pad.t-pad.b;
  const xMin=-6,xMax=6;
  const toX=x=>pad.l+((x-xMin)/(xMax-xMin))*pw;
  const maxY=normalPDF(mu,mu,sig);
  const toY=y=>pad.t+ph*(1-y/maxY*0.9);

  // Grid
  ctx.strokeStyle='#1e1e30';ctx.lineWidth=1;
  for(let x=-6;x<=6;x++){
    if(x===0)continue;
    ctx.beginPath();ctx.moveTo(toX(x),pad.t);ctx.lineTo(toX(x),pad.t+ph);ctx.stroke();
  }
  // Axis
  ctx.strokeStyle='#2e2e48';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.moveTo(pad.l,pad.t+ph);ctx.lineTo(W-pad.r,pad.t+ph);ctx.stroke();
  ctx.fillStyle='#55556888';ctx.font='10px Space Mono';ctx.textAlign='center';
  for(let x=-6;x<=6;x+=2)ctx.fillText(x,toX(x),H-pad.b+18);

  // Shaded region
  if(region!=='none'){
    ctx.beginPath();
    const loC=Math.max(xMin,lo),hiC=Math.min(xMax,hi);
    ctx.moveTo(toX(loC),toY(0));
    for(let x=loC;x<=hiC;x+=0.02)ctx.lineTo(toX(x),toY(normalPDF(x,mu,sig)));
    ctx.lineTo(toX(hiC),toY(0));ctx.closePath();
    const grad=ctx.createLinearGradient(0,pad.t,0,pad.t+ph);
    grad.addColorStop(0,'rgba(6,182,212,0.3)');grad.addColorStop(1,'rgba(6,182,212,0.02)');
    ctx.fillStyle=grad;ctx.fill();
  }

  // Curve
  ctx.beginPath();
  for(let x=xMin;x<=xMax;x+=0.02){
    const px=toX(x),py=toY(normalPDF(x,mu,sig));
    x===xMin?ctx.moveTo(px,py):ctx.lineTo(px,py);
  }
  ctx.strokeStyle='#06b6d4';ctx.lineWidth=2.5;ctx.stroke();

  // Mean line
  ctx.setLineDash([6,4]);ctx.strokeStyle='rgba(6,182,212,0.5)';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(toX(mu),pad.t);ctx.lineTo(toX(mu),pad.t+ph);ctx.stroke();
  ctx.setLineDash([]);

  // Labels
  if(region!=='none'){
    ctx.fillStyle='#06b6d4';ctx.font='13px DM Sans';ctx.textAlign='center';
    ctx.fillText(area.toFixed(1)+'%',toX(mu),toY(normalPDF(mu,mu,sig)*0.4));
  }
}

// --- Compare ---
function drawCompare(){
  const muA=+document.getElementById('muASlider').value;
  const sigA=+document.getElementById('sigASlider').value;
  const muB=+document.getElementById('muBSlider').value;
  const sigB=+document.getElementById('sigBSlider').value;
  document.getElementById('muA').textContent=muA.toFixed(1);
  document.getElementById('sigA').textContent=sigA.toFixed(1);
  document.getElementById('muB').textContent=muB.toFixed(1);
  document.getElementById('sigB').textContent=sigB.toFixed(1);

  const canvas=document.getElementById('compareCanvas'),ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  canvas.width=canvas.offsetWidth*dpr;canvas.height=340*dpr;
  ctx.scale(dpr,dpr);
  const W=canvas.offsetWidth,H=340;
  ctx.clearRect(0,0,W,H);

  const pad={l:40,r:30,t:30,b:50};
  const pw=W-pad.l-pad.r,ph=H-pad.t-pad.b;
  const xMin=-8,xMax=8;
  const toX=x=>pad.l+((x-xMin)/(xMax-xMin))*pw;
  const maxY=Math.max(normalPDF(muA,muA,sigA),normalPDF(muB,muB,sigB));
  const toY=y=>pad.t+ph*(1-y/maxY*0.9);

  // Axis
  ctx.strokeStyle='#2e2e48';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(pad.l,pad.t+ph);ctx.lineTo(W-pad.r,pad.t+ph);ctx.stroke();
  ctx.fillStyle='#55556888';ctx.font='10px Space Mono';ctx.textAlign='center';
  for(let x=-8;x<=8;x+=2)ctx.fillText(x,toX(x),H-pad.b+18);

  // Fill A
  ctx.beginPath();ctx.moveTo(toX(xMin),toY(0));
  for(let x=xMin;x<=xMax;x+=0.02)ctx.lineTo(toX(x),toY(normalPDF(x,muA,sigA)));
  ctx.lineTo(toX(xMax),toY(0));ctx.closePath();
  ctx.fillStyle='rgba(6,182,212,0.12)';ctx.fill();

  // Fill B
  ctx.beginPath();ctx.moveTo(toX(xMin),toY(0));
  for(let x=xMin;x<=xMax;x+=0.02)ctx.lineTo(toX(x),toY(normalPDF(x,muB,sigB)));
  ctx.lineTo(toX(xMax),toY(0));ctx.closePath();
  ctx.fillStyle='rgba(244,114,182,0.12)';ctx.fill();

  // Curve A
  ctx.beginPath();
  for(let x=xMin;x<=xMax;x+=0.02){const px=toX(x),py=toY(normalPDF(x,muA,sigA));x===xMin?ctx.moveTo(px,py):ctx.lineTo(px,py);}
  ctx.strokeStyle='#06b6d4';ctx.lineWidth=2.5;ctx.stroke();

  // Curve B
  ctx.beginPath();
  for(let x=xMin;x<=xMax;x+=0.02){const px=toX(x),py=toY(normalPDF(x,muB,sigB));x===xMin?ctx.moveTo(px,py):ctx.lineTo(px,py);}
  ctx.strokeStyle='#f472b6';ctx.lineWidth=2.5;ctx.stroke();

  // Labels
  ctx.font='12px DM Sans';
  ctx.fillStyle='#06b6d4';ctx.textAlign='center';
  ctx.fillText('A: μ='+muA.toFixed(1)+', σ='+sigA.toFixed(1),toX(muA),toY(normalPDF(muA,muA,sigA))-12);
  ctx.fillStyle='#f472b6';
  ctx.fillText('B: μ='+muB.toFixed(1)+', σ='+sigB.toFixed(1),toX(muB),toY(normalPDF(muB,muB,sigB))-12);
}

// Init
loadPreset();
drawNormal();
drawCompare();

// Responsive redraw
window.addEventListener('resize',()=>{drawHistogram();drawBoxplot();drawNormal();drawCompare();});
</script>
</body>
</html>
